<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ</title>
<style>
body { font-family: "Cairo", sans-serif; padding: 50px; background: #f5f5f5; direction: rtl; text-align: center; }
.container { max-width: 400px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
input, button { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; text-align: center; }
button { cursor: pointer; background: #007bff; color: white; border: none; border-radius: 6px; }
button:hover { background: #0056b3; }
.result { margin-top: 20px; }
</style>
</head>
<body>
<div class="container">
  <h2>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ</h2>
  <input type="text" id="idNumber" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ" maxlength="14" oninput="validateInput(this)">
  <button onclick="search()">Ø¨Ø­Ø«</button>
  <div class="result" id="result"></div>
</div>

<script>
function arabicToEnglishNumbers(str) {
  const arabic = ['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©'];
  const english = ['0','1','2','3','4','5','6','7','8','9'];
  return str.split('').map(c => {
    const index = arabic.indexOf(c);
    return index > -1 ? english[index] : c;
  }).join('');
}

// ğŸ”¹ Ù…Ù†Ø¹ Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø´ÙŠØ¡ ØºÙŠØ± Ø£Ø±Ù‚Ø§Ù… (Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) ÙˆØ¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² 14 Ø±Ù‚Ù…
function validateInput(input) {
  input.value = input.value
    .replace(/[^0-9Ù -Ù©]/g, '') // Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    .slice(0, 14); // Ø£Ù‚ØµÙ‰ Ø·ÙˆÙ„ 14 Ø±Ù‚Ù…
}

async function search() {
  const resultDiv = document.getElementById('result');
  let id = document.getElementById('idNumber').value.replace(/\s/g,'');
  id = arabicToEnglishNumbers(id);

  if (id.length !== 14 || isNaN(id)) {
    resultDiv.textContent = "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·";
    return;
  }

  try {
    const res = await fetch(`/api/id?nationalId=${id}`);
    const data = await res.json();

    if (res.ok) {
      let html = "<table border='1' style='margin:auto; border-collapse:collapse;'>";
      html += "<tr>" + Object.keys(data).map(k => `<th>${k}</th>`).join('') + "</tr>";
      html += "<tr>" + Object.values(data).map(v => `<td>${v}</td>`).join('') + "</tr>";
      html += "</table>";
      resultDiv.innerHTML = html;
    } else {
      resultDiv.textContent = data.error || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª";
    }
  } catch (e) {
    resultDiv.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«";
    console.error(e);
  }
}
</script>
</body>
</html>
