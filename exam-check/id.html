<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>استعلام رقم الفحص</title>
<style>
body { font-family: "Cairo", sans-serif; padding: 50px; background: #f5f5f5; direction: rtl; text-align: center; }
.container { max-width: 400px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
input, button { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; text-align: center; }
button { cursor: pointer; background: #007bff; color: white; border: none; border-radius: 6px; }
button:hover { background: #0056b3; }
.result { margin-top: 20px; }
</style>
</head>
<body>
<div class="container">
  <h2>استعلام رقم الفحص</h2>
  <input type="text" id="idNumber" placeholder="ادخل الرقم القومي" maxlength="14" oninput="validateInput(this)">
  <button onclick="search()">بحث</button>
  <div class="result" id="result"></div>
</div>

<script>
function arabicToEnglishNumbers(str) {
  const arabic = ['٠','١','٢','٣','٤','٥','٦','٧','٨','٩'];
  const english = ['0','1','2','3','4','5','6','7','8','9'];
  return str.split('').map(c => {
    const index = arabic.indexOf(c);
    return index > -1 ? english[index] : c;
  }).join('');
}

// 🔹 منع إدخال أي شيء غير أرقام (عربية أو إنجليزية) وعدم تجاوز 14 رقم
function validateInput(input) {
  input.value = input.value
    .replace(/[^0-9٠-٩]/g, '') // السماح فقط بالأرقام
    .slice(0, 14); // أقصى طول 14 رقم
}

async function search() {
  const resultDiv = document.getElementById('result');
  let id = document.getElementById('idNumber').value.replace(/\s/g,'');
  id = arabicToEnglishNumbers(id);

  if (id.length !== 14 || isNaN(id)) {
    resultDiv.textContent = "الرقم القومي يجب أن يكون 14 رقم بالضبط";
    return;
  }

  try {
    const res = await fetch(`/api/id?nationalId=${id}`);
    const data = await res.json();

    if (res.ok) {
      let html = "<table border='1' style='margin:auto; border-collapse:collapse;'>";
      html += "<tr>" + Object.keys(data).map(k => `<th>${k}</th>`).join('') + "</tr>";
      html += "<tr>" + Object.values(data).map(v => `<td>${v}</td>`).join('') + "</tr>";
      html += "</table>";
      resultDiv.innerHTML = html;
    } else {
      resultDiv.textContent = data.error || "لم يتم العثور على بيانات";
    }
  } catch (e) {
    resultDiv.textContent = "حدث خطأ أثناء البحث";
    console.error(e);
  }
}
</script>
</body>
</html>
